<div class="lift:surround?with=default;at=content">
  <h2>Fragments of a search interface</h2>

  <input type="text" id="search_word" value="">


  <div id="advancedSearch">
    <input type="radio" name="field" value="first">First Name
    <input type="radio" name="field" value="last">Last Name
    <input type="radio" name="field" value="all" checked="checked">All
<br/>
    <input type="text" id="residence">Country of Residence<br/>
    <input type="text" id="citizenship">Country of Citizenship<br/>
    <input type="submit" id="searchBtn" value="Search">
  </div>

  <div id="display"></div>

  <script>

  function displayData(data) {
    $('#display').html("")
    $('#display').append("Results: "+data.total)
    if (data.total > 0){
      $('#display').append("<table><tr><th>Name</th><th>Position</th><th>Nationality</th><th>Residence</th></tr>")
      $.each(data.hits, function(i, person) {
        $('#display').append("<tr>")
        $('#display').append("<td class='personRow' name="+i+">"+person._source["First Name"]+" "+person._source["Middle Name"]+" "+person._source["Last Name"]+"</td>")
        $('#display').append("<td>"+person._source["Position"]+"</td>")
        $('#display').append("<td>"+person._source["Country of Citizenship"]+"</td>")
        $('#display').append("<td>"+person._source["Country of residence"]+"</td>")
        $('#display').append("</tr>")
      })
      $('#display').append("</table>");
    }
    enableDoubleClick(data.hits)
  }

  function enableDoubleClick(hits) {
    $(".personRow" ).dblclick(function() {
      // console.log(hits[$(this).attr("name")])
      console.log(hits[$(this).attr("name")]._source["First Name"])
    })
  }

  function getNameArray(){
    var name_array = []
    var name_field = $('input[name=field]:checked').val()
    if(name_field == "first")
      name_array = ["First Name"]
    else if (name_field == "last")
      name_array = ["Last Name"]
    else
      name_array = ["First Name", "Middle Name", "Last Name"]
    return JSON.stringify(name_array)
  }

//nicer: (and then use data: JSON.stringify(search_json) in ajax-function)
  // var search_json = {
  //   "query" : {
  //     "multi_match" : {
  //       "query" : ""+$('#search_word')+"",
  //       "fields" : getNameArray()
  //     }
  //     "match" : {
  //       "Country of residence" : ""+$('#residence')+""
  //     },
  //     "match" : {
  //       "Country of Citizenship" : ""+$('#citizenship')+""
  //     }
  //   }
  // }

function createSearchJson(){
  var search_json = '{'
  search_json += '  "query" : {'
  search_json += '    "bool" : {'
  search_json += '      "must" : ['
  search_json += '        {'
  search_json += '          "multi_match" : {'
  search_json += '            "query" : "'+$('#search_word').val()+'",'
  search_json += '            "fields" : '+getNameArray()
  search_json += '          }'
  search_json += '        }'
  if ($('#residence').val() != ""){
    search_json += '        ,{'
    search_json += '          "match" : {"City of residence" : "'+$('#residence').val()+'}'
    search_json += '        }'
  }
  if ($('#citizenship').val() != ""){
    search_json += '        ,{'
    search_json += '          "match" : {"City of Citizenship" : "'+$('#citizenship').val()+'}'
    search_json += '        }'
  }
  search_json += '      ]'
  search_json += '    }'
  search_json += '  }'
  search_json += '}'
  return search_json
}



  $("#searchBtn").click(function() {
    $.ajax({
      type: "POST",
      url: "http://localhost:8080/search",
      data: createSearchJson(),
      success: function(data){
        displayData(data.hits)
      },
      dataType: "json",
      contentType:'application/json'
      });
   })
  </script>
</div>

